<!DOCTYPE html>
<html>
  <head>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: Roboto;
        font-size: 20px;
      }
      select,
      input,
      button {
        font-family: Roboto;
        font-size: 20px;
      }
      #canvas-container {
        width: 80%;
      }
      @media (max-aspect-ratio: 1/1) {
        #canvas-container {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div style="display: flex; justify-content: center; margin-top: 40px">
      <label>
        Market:
        <select id="market" value="c">
          <option value="c">Web3</option>
          <option value="t">Taiwan Stock</option>
          <option value="u">United States Stock</option>
        </select>
      </label>
      <div style="width: 40px"></div>
      <label>Symbol: <input id="symbol" type="text" value="ETH" /></label>
      <div style="width: 40px"></div>
      <button onclick="plot()">Simulate</button>
    </div>
    <div id="canvas-container" style="margin: 40px auto">
      <canvas id="chart"></canvas>
    </div>
    <script>
      let chart;
      async function plot() {
        let market = document.getElementById("market").value;
        let symbol = document.getElementById("symbol").value;
        let res = await fetch(
          `http://52.198.155.160:8080/chart?market=${market}&symbol=${symbol}`
        );
        if (!res.ok) {
          alert(res.statusText);
          return;
        }
        let data = await res.json();
        let datasets = [
          {
            label: "Buy Signals",
            data: data.X_b.map((e, i) => {
              return { x: e, y: data.Y_b[i] };
            }),
            backgroundColor: "rgba(75, 192, 192, 1)",
            radius: 5,
          },
          {
            label: "Sell Signals",
            data: data.X_s.map((e, i) => {
              return { x: e, y: data.Y_s[i] };
            }),
            backgroundColor: "rgba(255, 99, 132, 1)",
            radius: 5,
          },
          {
            label: "Close Prices",
            data: data.P.map((e, i) => [i, e]),
            showLine: true,
          },
        ];
        if (chart) {
          chart.data.datasets = datasets;
          chart.update();
          return;
        }
        chart = new Chart(document.getElementById("chart"), {
          data: { datasets },
          type: "scatter",
        });
      }
    </script>
  </body>
</html>
